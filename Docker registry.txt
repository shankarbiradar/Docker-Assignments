docker run -d -p 443:5000 --restart=always -v /reg:/var/lib/registry --name registry registry:2
vi /lib/systemd/system/docker.service

-H fd:// -insecure-registry 172.17.0.86:443 
curl -v 172.17.0.86:443/v2/
mkdir -p docker_reg_certs
openssl req  -newkey rsa:4096 -nodes -sha256 -keyout docker_reg_certs/domain.key -x509 -days 365 -out docker_reg_certs/domain.crt
mkdir -p /etc/docker/certs.d/172.17.0.86:443

cp /root/docker_reg_certs/domain.crt /etc/docker/certs.d/172.17.0.86:443/ca.crt

cp /root/docker_reg_certs/domain.crt /usr/local/share/ca-certificates/ca.crt
update-ca-certificates
mkdir docker_reg_auth
docker run -it --entrypoint htpasswd -v $PWD/docker_reg_auth:/auth -w /auth registry:2 -Bbc /auth/htpasswd docker d0ck3rrU73z

docker run -d -p 443:5000 --restart=always --name registry -v $PWD/docker_reg_certs:/certs -v $PWD/docker_reg_auth:/auth -v /reg:/var/lib/registry -e REGISTRY_HTTP_TLS_CERTIFICATE=/certs/domain.crt -e REGISTRY_HTTP_TLS_KEY=/certs/domain.key -e "REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm" -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd -e REGISTRY_AUTH=htpasswd registry:2

$docker login -udocker -pd0ck3rrU73z 172.17.0.86:443
$docker push 172.17.0.86:443/image:tag
$docker pull 172.17.0.86:443/image:tag

docker pull ubuntu:16.04
docker tag ubuntu:16.04 172.17.0.86:443/test-image:1
docker push 172.17.0.86:443/test-image:1
docker image remove ubuntu:16.04
docker image remove 172.17.0.86:443/test-image:1
docker pull 172.17.0.86:443/test-image:1
docker logout
